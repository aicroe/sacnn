{% extends "base.html" %}
{% block head %}
    {{ super() }}
    <script src="/static/train.js"></script>
{% endblock %}
{% block content %}
    <div id="trainer" class="ui segment">
        <form v-if="!error" v-show="!trainState" class="ui form">
            <div class="field">
                <label>Arquitectura:</label>
                <select v-model="arch" v-bind:disabled="!!trainState" required>
                    <option value="kim">Kim</option>
                    <option value="evolved">Evolucionada</option>
                </select>
            </div>
            <div class="field">
                <label>Nombre de la instancia:</label>
                <input v-model="instanceName" v-bind:disabled="!!trainState" required>
            </div>
            <div class="field" v-if="arch === 'evolved'">
                <label>Unidades escondidas:</label>
                <input v-model="hiddenUnits" v-bind:disabled="!!trainState" type="number" min="1" required>
            </div>
            <div class="field">
                <label>Número de etiquetas:</label>
                <select v-model="numLabels" v-bind:disabled="!!trainState" required>
                    <option v-bind:value="3">3</option>
                    <option v-bind:value="5">5</option>
                </select>
            </div>
            <div class="field">
                <label>Tasa de aprendizaje:</label>
                <input v-model="learningRate" v-bind:disabled="!!trainState" type="number" min="0" step="0.0001" required>
            </div>
            <div class="field">
                <label>Número de iteraciones:</label>
                <input v-model="epochs" v-bind:disabled="!!trainState" type="number" min="1" required>
            </div>
            <div class="field">
                <label>Calcular costo cada # iteración:</label>
                <input v-model="epochPrintCost" v-bind:disabled="!!trainState" type="number" min="1" required>
            </div>
            <div class="field">
                <label>Tamaño mini-lote:</label>
                <input v-model="minibatchSize" v-bind:disabled="!!trainState" type="number" min="1" required>
            </div>
            <div class="field">
                <label>Tasa de dropout:</label>
                <input v-model="keepProb" v-bind:disabled="!!trainState" type="number" min="0" step="0.01" required>
            </div>
            <input class="ui button" v-bind:disabled="!!trainState || epochPrintCost > epochs" type="submit" value="Entrenar" v-on:click="trainInstance">
        </form>
        <div v-if="!error" v-show="trainState">
            <div class="ui teal progress" id="progress-bar">
                <div class="bar">
                    <div class="progress"></div>
                </div>
                <div class="label">Entrenando</div>
            </div>
            <img v-if="trainState === 'finished'" v-bind:src="'/train/' + instanceName + '/learning-curve'" alt="Curva de aprendizaje" class="center">
        </div>
        <div v-if="error">
            <h4 v-html="error" class="red"></h4>
        </div>
    </div>
{% endblock %}